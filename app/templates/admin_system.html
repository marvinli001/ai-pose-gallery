<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统设置 - AI姿势参考图库</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <style>
        /* ===== 全局样式 ===== */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --danger-gradient: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            --secondary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 5px 20px rgba(0,0,0,0.15);
            --shadow-heavy: 0 10px 30px rgba(0,0,0,0.2);
            --border-radius: 15px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #2c3e50;
        }

        /* ===== 容器布局 ===== */
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            margin: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-heavy);
            min-height: calc(100vh - 40px);
        }

        /* ===== 页面头部 ===== */
        .admin-header {
            background: var(--secondary-gradient);
            color: white;
            padding: 2.5rem 2rem;
            position: relative;
            overflow: hidden;
        }

        .admin-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1.5" fill="white" opacity="0.08"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.12"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        }

        .admin-header .row {
            position: relative;
            z-index: 2;
        }

        .admin-header h1 {
            font-weight: 700;
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .admin-header p {
            opacity: 0.85;
            font-size: 1.1rem;
        }

        /* ===== 性能监控卡片 ===== */
        .metric-cards {
            padding: 2rem;
            margin-bottom: 1rem;
        }

        .metric-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9ff 100%);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-medium);
            transition: var(--transition);
            height: 100%;
            border: 1px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--secondary-gradient);
        }

        .metric-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.2);
        }

        .metric-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }

        .metric-card:hover .metric-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .metric-primary { background: var(--primary-gradient); }
        .metric-success { background: var(--success-gradient); }
        .metric-warning { background: var(--warning-gradient); }
        .metric-info { background: var(--info-gradient); }
        .metric-danger { background: var(--danger-gradient); }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0.5rem 0;
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .metric-label {
            color: #6c757d;
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .metric-change {
            font-size: 0.8rem;
            color: #6c757d;
            background: rgba(0,0,0,0.03);
            padding: 0.3rem 0.6rem;
            border-radius: 10px;
            margin-top: 0.5rem;
        }

        /* ===== 标签页区域 ===== */
        .tab-section {
            background: linear-gradient(135deg, #fff 0%, #f8f9ff 100%);
            border-radius: 20px;
            margin: 0 2rem 2rem;
            overflow: hidden;
            box-shadow: var(--shadow-medium);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .nav-tabs {
            border-bottom: none;
            background: var(--secondary-gradient);
            padding: 1.5rem 2rem 0;
            position: relative;
        }

        .nav-tabs::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(255,255,255,0.2);
        }

        .nav-tabs .nav-link {
            border: none;
            border-radius: 12px 12px 0 0;
            margin-right: 0.5rem;
            color: rgba(255,255,255,0.7);
            font-weight: 600;
            padding: 1rem 1.5rem;
            transition: var(--transition);
            background: transparent;
            position: relative;
            overflow: hidden;
        }

        .nav-tabs .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .nav-tabs .nav-link:hover::before {
            left: 100%;
        }

        .nav-tabs .nav-link:hover {
            color: white;
            background: rgba(255,255,255,0.1);
        }

        .nav-tabs .nav-link.active {
            background: white;
            color: #667eea;
            font-weight: 700;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
        }

        .tab-content {
            padding: 2.5rem 2rem;
            background: white;
        }

        /* ===== 操作卡片 ===== */
        .action-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9ff 100%);
            border-radius: 20px;
            padding: 2rem;
            border: 2px solid rgba(102, 126, 234, 0.1);
            transition: var(--transition);
            text-align: center;
            height: 100%;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .action-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .action-card:hover {
            border-color: #667eea;
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.2);
        }

        .action-card:hover::before {
            transform: scaleX(1);
        }

        .action-icon {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            transition: var(--transition);
        }

        .action-card:hover .action-icon {
            transform: scale(1.1) rotateY(180deg);
        }

        /* ===== 日志容器 ===== */
        .log-container {
            background: linear-gradient(135deg, #1e1e1e 0%, #2c2c2c 100%);
            color: #ffffff;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 500px;
            overflow-y: auto;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow-medium);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .log-line {
            margin-bottom: 0.3rem;
            word-wrap: break-word;
            padding: 0.2rem 0;
            border-left: 3px solid transparent;
            padding-left: 0.5rem;
        }

        .log-timestamp {
            color: #6c757d;
            font-weight: 600;
        }

        .log-level-error {
            color: #ff6b8a;
            border-left-color: #ff6b8a;
            background: rgba(255, 107, 138, 0.1);
        }

        .log-level-warning {
            color: #ffc947;
            border-left-color: #ffc947;
            background: rgba(255, 201, 71, 0.1);
        }

        .log-level-info {
            color: #4facfe;
            border-left-color: #4facfe;
            background: rgba(79, 172, 254, 0.1);
        }

        /* ===== 配置区域 ===== */
        .config-section {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-light);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .config-section h6 {
            color: #667eea;
            font-weight: 700;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            transition: var(--transition);
        }

        .config-item:hover {
            background: rgba(102, 126, 234, 0.05);
            margin: 0 -1rem;
            padding-left: 1rem;
            padding-right: 1rem;
            border-radius: 8px;
        }

        .config-item:last-child {
            border-bottom: none;
        }

        .config-label {
            font-weight: 600;
            color: #495057;
        }

        .config-value {
            color: #6c757d;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.9rem;
            background: rgba(0,0,0,0.03);
            padding: 0.3rem 0.6rem;
            border-radius: 8px;
        }

        /* ===== 状态指示器 ===== */
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .status-online { 
            background: linear-gradient(135deg, #28a745, #20c997);
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
        }

        .status-warning { 
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
        }

        .status-offline { 
            background: linear-gradient(135deg, #dc3545, #c82333);
            box-shadow: 0 0 10px rgba(220, 53, 69, 0.5);
        }

        /* ===== 备份项目 ===== */
        .backup-item {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary-gradient);
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }

        .backup-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-medium);
        }

        /* ===== 图表容器 ===== */
        .performance-chart {
            height: 350px;
            background: white;
            border-radius: 15px;
            padding: 1rem;
            box-shadow: var(--shadow-light);
            border: 1px solid rgba(0,0,0,0.05);
        }

        /* ===== 按钮样式 ===== */
        .btn {
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: var(--transition);
            border: none;
            position: relative;
            overflow: hidden;
            font-size: 0.95rem;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--primary-gradient);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: var(--success-gradient);
            box-shadow: 0 4px 15px rgba(86, 171, 47, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(86, 171, 47, 0.4);
        }

        .btn-warning {
            background: var(--warning-gradient);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
        }

        .btn-info {
            background: var(--info-gradient);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .btn-danger {
            background: var(--danger-gradient);
            box-shadow: 0 4px 15px rgba(255, 65, 108, 0.3);
        }

        .btn-outline-primary {
            border: 2px solid #667eea;
            color: #667eea;
            background: transparent;
        }

        .btn-outline-primary:hover {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-outline-warning,
        .btn-outline-success,
        .btn-outline-info,
        .btn-outline-secondary,
        .btn-outline-danger {
            border-width: 2px;
            font-weight: 600;
        }

        /* ===== 表单控件 ===== */
        .form-control, .form-select {
            border-radius: 12px;
            border: 2px solid rgba(0,0,0,0.1);
            padding: 0.75rem 1rem;
            transition: var(--transition);
            background: rgba(255,255,255,0.9);
            font-size: 0.95rem;
        }

        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
            background: white;
        }

        /* ===== 表格样式 ===== */
        .table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }

        .table thead {
            background: var(--secondary-gradient);
            color: white;
        }

        .table th {
            border: none;
            padding: 1.2rem 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.85rem;
        }

        .table td {
            border: none;
            padding: 1rem;
            vertical-align: middle;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .table tbody tr {
            transition: var(--transition);
        }

        .table tbody tr:hover {
            background: rgba(102, 126, 234, 0.05);
            transform: scale(1.01);
        }

        /* ===== 进度条样式 ===== */
        .progress {
            border-radius: 10px;
            height: 8px;
            background: rgba(0,0,0,0.1);
        }

        .progress-bar {
            border-radius: 10px;
            transition: width 0.6s ease;
        }

        /* ===== 徽章样式 ===== */
        .badge {
            border-radius: 20px;
            padding: 0.5rem 1rem;
            font-weight: 600;
        }

        .badge.bg-success {
            background: var(--success-gradient) !important;
        }

        .badge.bg-danger {
            background: var(--danger-gradient) !important;
        }

        .badge.bg-warning {
            background: var(--warning-gradient) !important;
        }

        .badge.bg-info {
            background: var(--info-gradient) !important;
        }

        .badge.bg-primary {
            background: var(--primary-gradient) !important;
        }

        /* ===== 加载遮罩 ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            display: none;
            backdrop-filter: blur(10px);
        }

        .loading-content {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow-heavy);
            animation: loadingPulse 2s ease-in-out infinite;
        }

        @keyframes loadingPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* ===== 通知样式 ===== */
        .alert {
            border-radius: var(--border-radius);
            border: none;
            padding: 1rem 1.5rem;
            font-weight: 500;
            box-shadow: var(--shadow-light);
        }

        .alert-success {
            background: linear-gradient(135deg, #d4edda, #a8e6cf);
            color: #155724;
        }

        .alert-danger {
            background: linear-gradient(135deg, #f8d7da, #fab1a0);
            color: #721c24;
        }

        .alert-info {
            background: linear-gradient(135deg, #cce7ff, #a8d8ea);
            color: #0c5460;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
        }

        /* ===== 响应式设计 ===== */
        @media (max-width: 768px) {
            .main-container {
                margin: 10px;
                border-radius: 20px;
            }
            
            .admin-header {
                padding: 2rem 1.5rem;
            }
            
            .admin-header h1 {
                font-size: 1.8rem;
            }
            
            .metric-cards, .tab-section {
                margin-left: 1rem;
                margin-right: 1rem;
                padding: 1.5rem;
            }
            
            .metric-card {
                padding: 1.5rem;
                margin-bottom: 1rem;
            }
            
            .metric-value {
                font-size: 2rem;
            }
            
            .tab-content {
                padding: 1.5rem;
            }
            
            .action-card {
                margin-bottom: 1rem;
            }
            
            .nav-tabs {
                padding: 1rem;
            }
            
            .nav-tabs .nav-link {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
        }

        /* ===== 滚动条样式 ===== */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary-gradient);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8, #6b59cc);
        }

        /* ===== 动画增强 ===== */
        .animate-fade-in {
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .animate-slide-up {
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== 特殊效果 ===== */
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .glow-effect {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        /* ===== 工具提示 ===== */
        [data-tooltip] {
            position: relative;
            cursor: help;
        }

        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        [data-tooltip]:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-5px);
        }

        /* ===== 清理结果样式 ===== */
        #cleanupResults {
            animation: slideUp 0.5s ease;
        }

        .cleanup-details {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0,0,0,0.03);
            border-radius: 10px;
            padding: 1rem;
        }

        /* ===== 系统状态徽章 ===== */
        .system-status-badge {
            background: var(--success-gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: var(--shadow-light);
        }
    </style>
</head>
<body>
    <!-- 顶部导航 -->
    {% include "components/admin_nav.html" %}

    <div class="main-container animate-fade-in">
        <!-- 页面标题 -->
        <div class="admin-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1>
                        <i class="fas fa-server me-3"></i>系统监控中心
                    </h1>
                    <p class="mb-0">实时监控系统性能 · 智能维护工具 · 配置管理 · 备份恢复</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="d-flex align-items-center justify-content-end gap-3">
                        <span class="system-status-badge">
                            <i class="fas fa-circle status-indicator status-online"></i>
                            系统运行正常
                        </span>
                        <button class="btn btn-light" onclick="refreshAllData()" data-tooltip="刷新所有系统数据">
                            <i class="fas fa-sync-alt me-2"></i>刷新数据
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 性能监控卡片 -->
        <div class="metric-cards">
            <div class="row">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="metric-card animate-slide-up">
                        <div class="metric-icon metric-primary">
                            <i class="fas fa-microchip"></i>
                        </div>
                        <div class="metric-label">CPU 使用率</div>
                        <h3 class="metric-value" id="cpuUsage">-</h3>
                        <div class="metric-change">
                            <i class="fas fa-processor me-1"></i>
                            <span id="cpuCores">- 核心</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="metric-card animate-slide-up" style="animation-delay: 0.1s;">
                        <div class="metric-icon metric-success">
                            <i class="fas fa-memory"></i>
                        </div>
                        <div class="metric-label">内存使用率</div>
                        <h3 class="metric-value" id="memoryUsage">-</h3>
                        <div class="metric-change">
                            <i class="fas fa-microchip me-1"></i>
                            <span id="memoryDetails">- / -</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="metric-card animate-slide-up" style="animation-delay: 0.2s;">
                        <div class="metric-icon metric-warning">
                            <i class="fas fa-hdd"></i>
                        </div>
                        <div class="metric-label">磁盘使用率</div>
                        <h3 class="metric-value" id="diskUsage">-</h3>
                        <div class="metric-change">
                            <i class="fas fa-database me-1"></i>
                            <span id="diskDetails">- / -</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="metric-card animate-slide-up" style="animation-delay: 0.3s;">
                        <div class="metric-icon metric-info">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="metric-label">存储大小</div>
                        <h3 class="metric-value" id="dbSize">-</h3>
                        <div class="metric-change">
                            <i class="fas fa-file me-1"></i>
                            <span id="dbTables">- 文件</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主要功能标签页 -->
        <div class="tab-section">
            <ul class="nav nav-tabs" id="systemTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" 
                            type="button" role="tab" onclick="showPerformanceTab()">
                        <i class="fas fa-chart-line me-2"></i>性能监控
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="maintenance-tab" data-bs-toggle="tab" data-bs-target="#maintenance" 
                            type="button" role="tab" onclick="showMaintenanceTab()">
                        <i class="fas fa-tools me-2"></i>系统维护
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="config-tab" data-bs-toggle="tab" data-bs-target="#config" 
                            type="button" role="tab" onclick="showConfigTab()">
                        <i class="fas fa-cog me-2"></i>系统配置
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs" 
                            type="button" role="tab" onclick="showLogsTab()">
                        <i class="fas fa-file-alt me-2"></i>系统日志
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="backup-tab" data-bs-toggle="tab" data-bs-target="#backup" 
                            type="button" role="tab" onclick="showBackupTab()">
                        <i class="fas fa-archive me-2"></i>备份管理
                    </button>
                </li>
            </ul>
            
            <div class="tab-content" id="systemTabsContent">
                <!-- 性能监控标签页 -->
                <div class="tab-pane fade show active" id="performance" role="tabpanel">
                    <div class="row">
                        <!-- 实时性能图表 -->
                        <div class="col-md-6 mb-4">
                            <h5 class="mb-3">
                                <i class="fas fa-chart-area text-primary me-2"></i>CPU & 内存使用趋势
                            </h5>
                            <div class="performance-chart">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <h5 class="mb-3">
                                <i class="fas fa-chart-bar text-success me-2"></i>磁盘I/O统计
                            </h5>
                            <div class="performance-chart">
                                <canvas id="diskIOChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- 进程列表 -->
                        <div class="col-md-12">
                            <h5 class="mb-3">
                                <i class="fas fa-list text-info me-2"></i>系统进程监控 (Top 10)
                            </h5>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>
                                                <i class="fas fa-hashtag me-1"></i>PID
                                            </th>
                                            <th>
                                                <i class="fas fa-cog me-1"></i>进程名
                                            </th>
                                            <th>
                                                <i class="fas fa-microchip me-1"></i>CPU使用率
                                            </th>
                                            <th>
                                                <i class="fas fa-memory me-1"></i>内存使用率
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="processTableBody">
                                        <tr>
                                            <td colspan="4" class="text-center py-5">
                                                <div class="spinner-border text-primary pulse-animation" role="status" style="width: 3rem; height: 3rem;">
                                                    <span class="visually-hidden">加载中...</span>
                                                </div>
                                                <p class="mt-3 text-muted fw-semibold">正在加载进程信息...</p>
                                                <small class="text-muted">实时获取系统进程数据</small>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系统维护标签页 -->
                <div class="tab-pane fade" id="maintenance" role="tabpanel">
                    <div class="row">
                        <div class="col-md-12 mb-4">
                            <h5>
                                <i class="fas fa-broom text-warning me-2"></i>智能系统清理工具
                            </h5>
                            <p class="text-muted">定期清理系统垃圾文件，释放存储空间并提升系统性能</p>
                        </div>
                        
                        <div class="col-md-4 mb-4">
                            <div class="action-card" onclick="performCleanup('temp_files')">
                                <div class="action-icon">
                                    <i class="fas fa-trash-alt"></i>
                                </div>
                                <h6 class="fw-bold">清理临时文件</h6>
                                <p class="text-muted small mb-3">删除超过1小时的临时文件和缓存</p>
                                <button class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-play me-1"></i>开始清理
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-4">
                            <div class="action-card" onclick="performCleanup('orphaned_files')">
                                <div class="action-icon">
                                    <i class="fas fa-unlink"></i>
                                </div>
                                <h6 class="fw-bold">清理孤立文件</h6>
                                <p class="text-muted small mb-3">删除数据库中不存在记录的文件</p>
                                <button class="btn btn-outline-warning btn-sm">
                                    <i class="fas fa-play me-1"></i>开始清理
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-4">
                            <div class="action-card" onclick="performCleanup('cache')">
                                <div class="action-icon">
                                    <i class="fas fa-memory"></i>
                                </div>
                                <h6 class="fw-bold">清理内存缓存</h6>
                                <p class="text-muted small mb-3">释放Python垃圾回收内存</p>
                                <button class="btn btn-outline-success btn-sm">
                                    <i class="fas fa-play me-1"></i>开始清理
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-4">
                            <div class="action-card" onclick="performCleanup('logs')">
                                <div class="action-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <h6 class="fw-bold">清理日志文件</h6>
                                <p class="text-muted small mb-3">清空历史系统日志文件</p>
                                <button class="btn btn-outline-info btn-sm">
                                    <i class="fas fa-play me-1"></i>开始清理
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-4">
                            <div class="action-card" onclick="performCleanup('thumbnails')">
                                <div class="action-icon">
                                    <i class="fas fa-images"></i>
                                </div>
                                <h6 class="fw-bold">清理缩略图</h6>
                                <p class="text-muted small mb-3">删除所有生成的缩略图缓存</p>
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-play me-1"></i>开始清理
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-4">
                            <div class="action-card" onclick="optimizeDatabase()">
                                <div class="action-icon">
                                    <i class="fas fa-database"></i>
                                </div>
                                <h6 class="fw-bold">优化数据库</h6>
                                <p class="text-muted small mb-3">执行VACUUM和重建索引操作</p>
                                <button class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-play me-1"></i>开始优化
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 清理结果 -->
                    <div id="cleanupResults" class="mt-4" style="display: none;">
                        <h5>
                            <i class="fas fa-check-circle text-success me-2"></i>清理结果报告
                        </h5>
                        <div id="cleanupResultsContent"></div>
                    </div>
                </div>

                <!-- 系统配置标签页 -->
                <div class="tab-pane fade" id="config" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="config-section">
                                <h6>
                                    <i class="fas fa-database me-2"></i>数据库配置
                                </h6>
                                <div id="databaseConfig">
                                    <div class="text-center py-4">
                                        <div class="spinner-border text-primary pulse-animation" role="status">
                                            <span class="visually-hidden">加载中...</span>
                                        </div>
                                        <p class="mt-2 text-muted">正在加载数据库配置...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="config-section">
                                <h6>
                                    <i class="fas fa-upload me-2"></i>上传配置
                                </h6>
                                <div id="uploadConfig">
                                    <div class="text-center py-4">
                                        <div class="spinner-border text-primary pulse-animation" role="status">
                                            <span class="visually-hidden">加载中...</span>
                                        </div>
                                        <p class="mt-2 text-muted">正在加载上传配置...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="config-section">
                                <h6>
                                    <i class="fas fa-key me-2"></i>JWT安全配置
                                </h6>
                                <div id="jwtConfig">
                                    <div class="text-center py-4">
                                        <div class="spinner-border text-primary pulse-animation" role="status">
                                            <span class="visually-hidden">加载中...</span>
                                        </div>
                                        <p class="mt-2 text-muted">正在加载JWT配置...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="config-section">
                                <h6>
                                    <i class="fas fa-robot me-2"></i>AI智能配置
                                </h6>
                                <div id="aiConfig">
                                    <div class="text-center py-4">
                                        <div class="spinner-border text-primary pulse-animation" role="status">
                                            <span class="visually-hidden">加载中...</span>
                                        </div>
                                        <p class="mt-2 text-muted">正在加载AI配置...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="config-section">
                                <h6>
                                    <i class="fas fa-cogs me-2"></i>应用程序配置
                                </h6>
                                <div id="appConfig">
                                    <div class="text-center py-4">
                                        <div class="spinner-border text-primary pulse-animation" role="status">
                                            <span class="visually-hidden">加载中...</span>
                                        </div>
                                        <p class="mt-2 text-muted">正在加载应用配置...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系统日志标签页 -->
                <div class="tab-pane fade" id="logs" role="tabpanel">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5>
                                    <i class="fas fa-file-alt text-info me-2"></i>实时系统日志
                                </h5>
                                <div class="d-flex gap-2">
                                    <select class="form-select form-select-sm" id="logTypeSelect" onchange="loadLogs()">
                                        <option value="application">📱 应用日志</option>
                                        <option value="error">❌ 错误日志</option>
                                        <option value="access">🌐 访问日志</option>
                                    </select>
                                    <select class="form-select form-select-sm" id="logLinesSelect" onchange="loadLogs()">
                                        <option value="50">最近50行</option>
                                        <option value="100" selected>最近100行</option>
                                        <option value="200">最近200行</option>
                                        <option value="500">最近500行</option>
                                    </select>
                                    <button class="btn btn-outline-primary btn-sm" onclick="loadLogs()" data-tooltip="刷新日志">
                                        <i class="fas fa-sync-alt me-1"></i>刷新
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-12">
                            <div class="log-container" id="logContainer">
                                <div class="text-center py-5">
                                    <div class="spinner-border text-light pulse-animation" role="status" style="width: 3rem; height: 3rem;">
                                        <span class="visually-hidden">加载中...</span>
                                    </div>
                                    <p class="mt-3 text-light fw-semibold">正在加载系统日志...</p>
                                    <small class="text-muted">实时获取最新日志信息</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 备份管理标签页 -->
                <div class="tab-pane fade" id="backup" role="tabpanel">
                    <div class="row">
                        <div class="col-md-12 mb-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5>
                                        <i class="fas fa-archive text-primary me-2"></i>智能备份管理
                                    </h5>
                                    <p class="text-muted mb-0">自动化备份系统，保障数据安全</p>
                                </div>
                                <button class="btn btn-success" onclick="createBackup()" data-tooltip="创建新的系统备份">
                                    <i class="fas fa-plus me-2"></i>创建新备份
                                </button>
                            </div>
                        </div>
                        
                        <div class="col-md-12">
                            <div id="backupsList">
                                <div class="text-center py-5">
                                    <div class="spinner-border text-primary pulse-animation" role="status" style="width: 3rem; height: 3rem;">
                                        <span class="visually-hidden">加载中...</span>
                                    </div>
                                    <p class="mt-3 text-muted fw-semibold">正在加载备份列表...</p>
                                    <small class="text-muted">获取所有可用备份文件</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载遮罩 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">加载中...</span>
            </div>
            <h5 id="loadingText">系统处理中...</h5>
            <p class="text-muted mb-0">请稍候，正在执行操作</p>
        </div>
    </div>
    
    <script>
        // 全局变量
        let performanceChart = null;
        let diskIOChart = null;
        let refreshInterval = null;
        let systemInfo = null;
        let performanceData = [];

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            initializeSystem();
            
            // 设置自动刷新 (每30秒)
            refreshInterval = setInterval(refreshMetrics, 30000);
        });

        // 检查用户权限
        async function checkAuth() {
            try {
                const response = await fetch('/api/auth/check');
                const data = await response.json();
                
                if (!data.authenticated) {
                    window.location.href = '/login?redirect=' + encodeURIComponent(window.location.pathname);
                    return;
                }
                
                if (data.user.role !== 'admin' && data.user.role !== 'moderator') {
                    showError('您没有管理员权限访问此页面');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                    return;
                }
            } catch (error) {
                console.error('权限检查失败:', error);
                showError('权限验证失败，请重新登录');
                setTimeout(() => {
                    window.location.href = '/login';
                }, 2000);
            }
        }

        // 初始化系统
        async function initializeSystem() {
            try {
                showLoading('正在初始化系统监控...');
                
                await loadSystemInfo();
                await loadPerformanceMetrics();
                await loadDatabaseStats();
                
                // 初始化图表
                initializeCharts();
                
                showSuccess('🚀 系统监控初始化完成！');
                console.log('✅ 系统监控初始化完成');
            } catch (error) {
                console.error('❌ 系统初始化失败:', error);
                showError('系统初始化失败，请刷新页面重试');
            } finally {
                hideLoading();
            }
        }

        // 加载系统信息
        async function loadSystemInfo() {
            try {
                const response = await fetch('/api/admin/system/info');
                const data = await response.json();
                
                if (data.success) {
                    systemInfo = data.data;
                    updateSystemMetrics(data.data);
                } else {
                    showError('加载系统信息失败');
                }
            } catch (error) {
                console.error('加载系统信息失败:', error);
                showError('网络错误，无法获取系统信息');
            }
        }

        // 加载性能指标
        async function loadPerformanceMetrics() {
            try {
                const response = await fetch('/api/admin/system/performance');
                const data = await response.json();
                
                if (data.success) {
                    updatePerformanceData(data.data);
                } else {
                    showError('加载性能数据失败');
                }
            } catch (error) {
                console.error('加载性能数据失败:', error);
                showWarning('性能监控暂时不可用');
            }
        }

        // 加载数据库统计
        async function loadDatabaseStats() {
            try {
                const response = await fetch('/api/admin/system/database-stats');
                const data = await response.json();
                
                if (data.success) {
                    updateDatabaseMetrics(data.data);
                } else {
                    showError('加载数据库统计失败');
                }
            } catch (error) {
                console.error('加载数据库统计失败:', error);
                showWarning('数据库统计暂时不可用');
            }
        }

        // 更新系统指标显示
        function updateSystemMetrics(data) {
            // CPU使用率
            animateNumber('cpuUsage', `${data.system.cpu_percent.toFixed(1)}%`);
            document.getElementById('cpuCores').innerHTML = `<i class="fas fa-microchip me-1"></i>${data.system.cpu_count} 核心`;
            
            // 内存使用率
            animateNumber('memoryUsage', `${data.memory.percent.toFixed(1)}%`);
            document.getElementById('memoryDetails').innerHTML = 
                `<i class="fas fa-memory me-1"></i>${data.memory.used_gb.toFixed(1)}GB / ${data.memory.total_gb.toFixed(1)}GB`;
            
            // 磁盘使用率
            animateNumber('diskUsage', `${data.disk.percent.toFixed(1)}%`);
            document.getElementById('diskDetails').innerHTML = 
                `<i class="fas fa-hdd me-1"></i>${data.disk.used_gb.toFixed(1)}GB / ${data.disk.total_gb.toFixed(1)}GB`;
            
            // 上传目录大小
            if (data.upload_directory && data.upload_directory.size_gb) {
                animateNumber('dbSize', `${data.upload_directory.size_gb.toFixed(2)}GB`);
                document.getElementById('dbTables').innerHTML = 
                    `<i class="fas fa-file me-1"></i>${formatNumber(data.upload_directory.file_count)} 文件`;
            }
            
            // 更新指标卡片颜色
            updateMetricCardColors(data);
        }

        // 数字动画效果
        function animateNumber(elementId, targetValue) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            element.style.transform = 'scale(1.1)';
            element.textContent = targetValue;
            
            setTimeout(() => {
                element.style.transform = 'scale(1)';
            }, 200);
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // 更新性能数据
        function updatePerformanceData(data) {
            // 更新进程列表
            updateProcessList(data.top_processes);
            
            // 添加到性能数据历史
            const timestamp = new Date().toLocaleTimeString();
            performanceData.push({
                timestamp: timestamp,
                cpu: data.cpu ? data.cpu.percent : 0,
                memory: data.memory ? data.memory.virtual.percent : 0,
                disk_read: data.disk_io ? data.disk_io.read_bytes : 0,
                disk_write: data.disk_io ? data.disk_io.write_bytes : 0
            });
            
            // 保持最近20个数据点
            if (performanceData.length > 20) {
                performanceData.shift();
            }
            
            // 更新图表
            updatePerformanceChart();
            updateDiskIOChart();
        }

        // 更新数据库指标
        function updateDatabaseMetrics(data) {
            if (data.database_file) {
                document.getElementById('dbSize').textContent = `${data.database_file.size_mb}MB`;
                document.getElementById('dbTables').innerHTML = 
                    `<i class="fas fa-table me-1"></i>${data.table_stats.users + data.table_stats.images} 记录`;
            }
        }

        // 更新指标卡片颜色
        function updateMetricCardColors(data) {
            // CPU颜色
            const cpuCard = document.querySelector('#cpuUsage').closest('.metric-card').querySelector('.metric-icon');
            if (data.system.cpu_percent > 80) {
                cpuCard.className = 'metric-icon metric-danger';
            } else if (data.system.cpu_percent > 60) {
                cpuCard.className = 'metric-icon metric-warning';
            } else {
                cpuCard.className = 'metric-icon metric-primary';
            }
            
            // 内存颜色
            const memCard = document.querySelector('#memoryUsage').closest('.metric-card').querySelector('.metric-icon');
            if (data.memory.percent > 85) {
                memCard.className = 'metric-icon metric-danger';
            } else if (data.memory.percent > 70) {
                memCard.className = 'metric-icon metric-warning';
            } else {
                memCard.className = 'metric-icon metric-success';
            }
                        // 磁盘颜色
            const diskCard = document.querySelector('#diskUsage').closest('.metric-card').querySelector('.metric-icon');
            if (data.disk.percent > 90) {
                diskCard.className = 'metric-icon metric-danger';
            } else if (data.disk.percent > 75) {
                diskCard.className = 'metric-icon metric-warning';
            } else {
                diskCard.className = 'metric-icon metric-warning';
            }
        }

        // 更新进程列表
        function updateProcessList(processes) {
            const tbody = document.getElementById('processTableBody');
            
            if (!processes || processes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center py-5">
                            <i class="fas fa-exclamation-triangle fa-2x text-muted mb-3"></i>
                            <p class="text-muted mb-0">暂无进程数据</p>
                            <small class="text-muted">系统可能正在加载中</small>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = processes.map((proc, index) => `
                <tr class="animate-slide-up" style="animation-delay: ${index * 0.1}s;">
                    <td>
                        <span class="badge bg-primary">${proc.pid}</span>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <i class="fas fa-cog text-primary me-2"></i>
                            <span class="fw-semibold">${proc.name}</span>
                        </div>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="progress flex-grow-1 me-3" style="height: 8px;">
                                <div class="progress-bar bg-primary" 
                                     style="width: ${Math.min((proc.cpu_percent || 0), 100)}%"
                                     data-tooltip="CPU: ${(proc.cpu_percent || 0).toFixed(1)}%"></div>
                            </div>
                            <small class="fw-bold text-primary">${(proc.cpu_percent || 0).toFixed(1)}%</small>
                        </div>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="progress flex-grow-1 me-3" style="height: 8px;">
                                <div class="progress-bar bg-success" 
                                     style="width: ${Math.min((proc.memory_percent || 0), 100)}%"
                                     data-tooltip="内存: ${(proc.memory_percent || 0).toFixed(1)}%"></div>
                            </div>
                            <small class="fw-bold text-success">${(proc.memory_percent || 0).toFixed(1)}%</small>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // 初始化图表
        function initializeCharts() {
            // 性能监控图表
            const perfCtx = document.getElementById('performanceChart');
            if (perfCtx) {
                performanceChart = new Chart(perfCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'CPU使用率',
                                data: [],
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: '#667eea',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2,
                                pointRadius: 6,
                                pointHoverRadius: 8
                            },
                            {
                                label: '内存使用率',
                                data: [],
                                borderColor: '#56ab2f',
                                backgroundColor: 'rgba(86, 171, 47, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: '#56ab2f',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2,
                                pointRadius: 6,
                                pointHoverRadius: 8
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                borderColor: '#667eea',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    maxTicksLimit: 10
                                }
                            },
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            }
                        },
                        animation: {
                            duration: 750,
                            easing: 'easeInOutQuart'
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
            }
            
            // 磁盘I/O图表
            const diskCtx = document.getElementById('diskIOChart');
            if (diskCtx) {
                diskIOChart = new Chart(diskCtx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: '读取 (MB)',
                                data: [],
                                backgroundColor: 'rgba(79, 172, 254, 0.8)',
                                borderColor: 'rgba(79, 172, 254, 1)',
                                borderWidth: 2,
                                borderRadius: 8,
                                borderSkipped: false
                            },
                            {
                                label: '写入 (MB)',
                                data: [],
                                backgroundColor: 'rgba(240, 147, 251, 0.8)',
                                borderColor: 'rgba(240, 147, 251, 1)',
                                borderWidth: 2,
                                borderRadius: 8,
                                borderSkipped: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                borderColor: '#4facfe',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    maxTicksLimit: 8
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value + ' MB';
                                    }
                                },
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                }
                            }
                        },
                        animation: {
                            duration: 750,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }
        }

        // 更新性能图表
        function updatePerformanceChart() {
            if (!performanceChart || performanceData.length === 0) return;
            
            const labels = performanceData.map(d => d.timestamp);
            const cpuData = performanceData.map(d => d.cpu);
            const memoryData = performanceData.map(d => d.memory);
            
            performanceChart.data.labels = labels;
            performanceChart.data.datasets[0].data = cpuData;
            performanceChart.data.datasets[1].data = memoryData;
            performanceChart.update('none');
        }

        // 更新磁盘I/O图表
        function updateDiskIOChart() {
            if (!diskIOChart || performanceData.length === 0) return;
            
            const labels = performanceData.slice(-10).map(d => d.timestamp);
            const readData = performanceData.slice(-10).map(d => (d.disk_read / (1024*1024)).toFixed(2));
            const writeData = performanceData.slice(-10).map(d => (d.disk_write / (1024*1024)).toFixed(2));
            
            diskIOChart.data.labels = labels;
            diskIOChart.data.datasets[0].data = readData;
            diskIOChart.data.datasets[1].data = writeData;
            diskIOChart.update('none');
        }

        // 标签页切换函数
        function showPerformanceTab() {
            console.log('🔄 切换到性能监控标签页');
            // 图表已经在初始化时创建，这里只需要刷新数据
            setTimeout(() => {
                if (performanceChart) performanceChart.resize();
                if (diskIOChart) diskIOChart.resize();
            }, 100);
        }

        function showMaintenanceTab() {
            console.log('🔧 切换到系统维护标签页');
            // 清理结果重置
            document.getElementById('cleanupResults').style.display = 'none';
        }

        async function showConfigTab() {
            console.log('⚙️ 切换到系统配置标签页');
            await loadSystemConfig();
        }

        async function showLogsTab() {
            console.log('📝 切换到系统日志标签页');
            await loadLogs();
        }

        async function showBackupTab() {
            console.log('💾 切换到备份管理标签页');
            await loadBackups();
        }

        // 系统清理功能
        async function performCleanup(cleanupType) {
            const typeNames = {
                'temp_files': '临时文件',
                'orphaned_files': '孤立文件',
                'cache': '内存缓存',
                'logs': '日志文件',
                'thumbnails': '缩略图缓存'
            };
            
            const typeIcons = {
                'temp_files': '🗑️',
                'orphaned_files': '🔗',
                'cache': '💾',
                'logs': '📄',
                'thumbnails': '🖼️'
            };
            
            const typeName = typeNames[cleanupType] || cleanupType;
            const typeIcon = typeIcons[cleanupType] || '🔧';
            
            if (!confirm(`${typeIcon} 确定要清理${typeName}吗？\n\n⚠️ 此操作不可撤销，建议先创建备份。`)) {
                return;
            }
            
            try {
                showLoading(`正在清理${typeName}...`);
                
                const response = await fetch(`/api/admin/system/cleanup?cleanup_type=${cleanupType}`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showCleanupResults(result.data);
                    showSuccess(`✅ ${typeName}清理完成！`);
                    
                    // 刷新系统信息
                    setTimeout(loadSystemInfo, 1000);
                } else {
                    showError(`❌ 清理${typeName}失败：${result.message || '未知错误'}`);
                }
            } catch (error) {
                console.error('清理失败:', error);
                showError('网络错误：' + error.message);
            } finally {
                hideLoading();
            }
        }

        // 显示清理结果
        function showCleanupResults(data) {
            const resultsDiv = document.getElementById('cleanupResults');
            const contentDiv = document.getElementById('cleanupResultsContent');
            
            let resultHtml = `
                <div class="alert alert-success animate-slide-up">
                    <div class="d-flex align-items-start">
                        <i class="fas fa-check-circle fa-2x text-success me-3"></i>
                        <div class="flex-grow-1">
                            <h6 class="fw-bold mb-2">清理操作成功完成</h6>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="text-center p-2 bg-white bg-opacity-50 rounded">
                                        <div class="fw-bold text-primary">${data.files_removed || 0}</div>
                                        <small class="text-muted">删除文件数</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center p-2 bg-white bg-opacity-50 rounded">
                                        <div class="fw-bold text-success">${formatFileSize(data.space_freed || 0)}</div>
                                        <small class="text-muted">释放空间</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center p-2 bg-white bg-opacity-50 rounded">
                                        <div class="fw-bold text-info">${data.type || '未知'}</div>
                                        <small class="text-muted">清理类型</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            if (data.details && data.details.length > 0) {
                resultHtml += `
                    <div class="card mt-3 animate-slide-up" style="animation-delay: 0.2s;">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-list text-info me-2"></i>清理详情
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="cleanup-details">
                                ${data.details.map(detail => `
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        <span class="small">${detail}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (data.errors && data.errors.length > 0) {
                resultHtml += `
                    <div class="card mt-3 border-warning animate-slide-up" style="animation-delay: 0.3s;">
                        <div class="card-header bg-warning bg-opacity-10">
                            <h6 class="mb-0 text-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>注意事项
                            </h6>
                        </div>
                        <div class="card-body">
                            ${data.errors.map(error => `
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fas fa-exclamation-circle text-warning me-2"></i>
                                    <span class="small">${error}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            contentDiv.innerHTML = resultHtml;
            resultsDiv.style.display = 'block';
            
            // 滚动到结果区域
            setTimeout(() => {
                resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }

        // 数据库优化
        async function optimizeDatabase() {
            if (!confirm('🔧 确定要优化数据库吗？\n\n⏱️ 这可能需要几分钟时间，期间系统可能会稍慢。\n💡 建议在系统空闲时进行此操作。')) {
                return;
            }
            
            try {
                showLoading('正在执行数据库优化...');
                
                const response = await fetch('/api/admin/system/optimize-database', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    let message = '🎉 数据库优化完成！\n\n📋 执行的操作:\n';
                    
                    data.operations.forEach(op => {
                        message += `• ${op}\n`;
                    });
                    
                    if (data.space_saved > 0) {
                        message += `\n💾 释放空间: ${formatFileSize(data.space_saved)}`;
                    }
                    
                    if (data.performance_improvement) {
                        message += `\n⚡ 性能提升: ${data.performance_improvement}`;
                    }
                    
                    alert(message);
                    showSuccess('✅ 数据库优化完成！');
                    
                    // 刷新系统信息
                    setTimeout(loadDatabaseStats, 1000);
                } else {
                    showError('❌ 数据库优化失败：' + (result.message || '未知错误'));
                }
            } catch (error) {
                console.error('数据库优化失败:', error);
                showError('网络错误：' + error.message);
            } finally {
                hideLoading();
            }
        }

        // 加载系统配置
        async function loadSystemConfig() {
            try {
                showLoading('正在加载系统配置...');
                
                const response = await fetch('/api/admin/system/config');
                const data = await response.json();
                
                if (data.success) {
                    displaySystemConfig(data.data);
                } else {
                    showError('加载系统配置失败');
                }
            } catch (error) {
                console.error('加载系统配置失败:', error);
                showError('网络错误，无法获取系统配置');
            } finally {
                hideLoading();
            }
        }

        // 显示系统配置
        function displaySystemConfig(config) {
            // 数据库配置
            document.getElementById('databaseConfig').innerHTML = `
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-database me-1"></i>数据库类型
                    </span>
                    <span class="config-value">${config.database?.type || 'SQLite'}</span>
                </div>
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-link me-1"></i>连接配置
                    </span>
                    <span class="config-value">${config.database?.url_pattern || 'sqlite:///ai_pose_db.sqlite'}</span>
                </div>
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-bolt me-1"></i>连接池大小
                    </span>
                    <span class="config-value">${config.database?.pool_size || '默认'}</span>
                </div>
            `;
            
            // 上传配置
            document.getElementById('uploadConfig').innerHTML = `
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-folder me-1"></i>上传目录
                    </span>
                    <span class="config-value">${config.upload?.directory || './uploads'}</span>
                </div>
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-weight-hanging me-1"></i>最大文件大小
                    </span>
                    <span class="config-value">${config.upload?.max_file_size_mb || 10}MB</span>
                </div>
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-file-image me-1"></i>允许的格式
                    </span>
                    <span class="config-value">${config.upload?.allowed_extensions?.join(', ') || 'jpg, png, gif'}</span>
                </div>
            `;
            
            // JWT配置
            document.getElementById('jwtConfig').innerHTML = `
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-shield-alt me-1"></i>加密算法
                    </span>
                    <span class="config-value">${config.jwt?.algorithm || 'HS256'}</span>
                </div>
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-clock me-1"></i>令牌有效期
                    </span>
                    <span class="config-value">${config.jwt?.expire_minutes || 60}分钟</span>
                </div>
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-key me-1"></i>密钥状态
                    </span>
                    <span class="config-value">
                        <span class="badge bg-${config.jwt?.secret_key_configured ? 'success' : 'danger'}">
                            ${config.jwt?.secret_key_configured ? '✅ 已配置' : '❌ 未配置'}
                        </span>
                    </span>
                </div>
            `;
            
            // AI配置
            document.getElementById('aiConfig').innerHTML = `
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-brain me-1"></i>OpenAI API
                    </span>
                    <span class="config-value">
                        <span class="badge bg-${config.ai?.openai_configured ? 'success' : 'warning'}">
                            ${config.ai?.openai_configured ? '🤖 已配置' : '⚠️ 未配置'}
                        </span>
                    </span>
                </div>
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-language me-1"></i>默认模型
                    </span>
                    <span class="config-value">${config.ai?.default_model || 'gpt-3.5-turbo'}</span>
                </div>
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-thermometer-half me-1"></i>分析温度
                    </span>
                    <span class="config-value">${config.ai?.temperature || 0.7}</span>
                </div>
            `;
            
            // 应用配置
            document.getElementById('appConfig').innerHTML = `
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-server me-1"></i>运行环境
                    </span>
                    <span class="config-value">
                        <span class="badge bg-${config.application?.environment === 'production' ? 'success' : 'warning'}">
                            ${config.application?.environment || 'development'}
                        </span>
                    </span>
                </div>
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-bug me-1"></i>调试模式
                    </span>
                    <span class="config-value">
                        <span class="badge bg-${config.application?.debug ? 'warning' : 'success'}">
                            ${config.application?.debug ? '🐛 启用' : '🔒 禁用'}
                        </span>
                    </span>
                </div>
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-tag me-1"></i>应用版本
                    </span>
                    <span class="config-value">${config.application?.version || '1.0.0'}</span>
                </div>
                <div class="config-item">
                    <span class="config-label">
                        <i class="fas fa-calendar me-1"></i>启动时间
                    </span>
                    <span class="config-value">${config.application?.start_time || new Date().toLocaleString('zh-CN')}</span>
                </div>
            `;
        }

        // 加载系统日志
        async function loadLogs() {
            const logType = document.getElementById('logTypeSelect').value;
            const lines = document.getElementById('logLinesSelect').value;
            
            try {
                showLoading('正在加载系统日志...');
                
                const response = await fetch(`/api/admin/system/logs?log_type=${logType}&lines=${lines}`);
                const data = await response.json();
                
                if (data.success) {
                    displayLogs(data.data);
                } else {
                    showError('加载日志失败：' + (data.message || '未知错误'));
                }
            } catch (error) {
                console.error('加载日志失败:', error);
                showError('网络错误，无法获取系统日志');
            } finally {
                hideLoading();
            }
        }

        // 显示日志
        function displayLogs(logData) {
            const container = document.getElementById('logContainer');
            
            if (!logData.content || logData.content.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                        <h5 class="text-light">日志文件为空</h5>
                        <p class="text-muted">当前日志类型暂无内容，或者日志文件不存在</p>
                        <button class="btn btn-outline-light btn-sm" onclick="loadLogs()">
                            <i class="fas fa-refresh me-1"></i>重新加载
                        </button>
                    </div>
                `;
                return;
            }
            
            const logHtml = logData.content.map((line, index) => {
                // 智能日志级别检测
                let logClass = '';
                let icon = '';
                
                if (line.toLowerCase().includes('error') || line.toLowerCase().includes('exception')) {
                    logClass = 'log-level-error';
                    icon = '<i class="fas fa-exclamation-triangle me-2"></i>';
                } else if (line.toLowerCase().includes('warning') || line.toLowerCase().includes('warn')) {
                    logClass = 'log-level-warning';
                    icon = '<i class="fas fa-exclamation-circle me-2"></i>';
                } else if (line.toLowerCase().includes('info')) {
                    logClass = 'log-level-info';
                    icon = '<i class="fas fa-info-circle me-2"></i>';
                } else {
                    icon = '<i class="fas fa-circle me-2" style="font-size: 0.5rem;"></i>';
                }
                
                return `
                    <div class="log-line ${logClass}" style="animation-delay: ${index * 0.02}s;">
                        ${icon}${escapeHtml(line)}
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom border-secondary">
                    <div class="text-light">
                        <i class="fas fa-terminal me-2"></i>
                        <strong>${logData.log_type || '系统'} 日志</strong>
                        <span class="badge bg-primary ms-2">${logData.content.length} 行</span>
                    </div>
                    <div class="text-muted small">
                        最后更新: ${new Date().toLocaleString('zh-CN')}
                    </div>
                </div>
                ${logHtml}
            `;
            
            // 自动滚动到底部
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        }

        // 备份管理功能
        async function loadBackups() {
            try {
                showLoading('正在加载备份列表...');
                
                const response = await fetch('/api/admin/system/backups');
                const data = await response.json();
                
                if (data.success) {
                    displayBackups(data.data);
                } else {
                    showError('加载备份列表失败：' + (data.message || '未知错误'));
                }
            } catch (error) {
                console.error('加载备份列表失败:', error);
                showError('网络错误，无法获取备份列表');
            } finally {
                hideLoading();
            }
        }

        // 显示备份列表
        function displayBackups(backupData) {
            const container = document.getElementById('backupsList');
            
            if (!backupData.backups || backupData.backups.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-archive fa-4x text-muted mb-4"></i>
                        <h5 class="text-muted">暂无备份文件</h5>
                        <p class="text-muted">系统还没有创建任何备份，建议定期备份以保障数据安全</p>
                        <button class="btn btn-primary" onclick="createBackup()">
                            <i class="fas fa-plus me-2"></i>创建第一个备份
                        </button>
                    </div>
                `;
                return;
            }
            
            const backupsHtml = `
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card text-center bg-primary bg-opacity-10 border-primary">
                            <div class="card-body">
                                <i class="fas fa-archive fa-2x text-primary mb-2"></i>
                                <h4 class="text-primary">${backupData.count || 0}</h4>
                                <small class="text-muted">备份总数</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center bg-success bg-opacity-10 border-success">
                            <div class="card-body">
                                <i class="fas fa-hdd fa-2x text-success mb-2"></i>
                                <h4 class="text-success">${formatFileSize(backupData.total_size || 0)}</h4>
                                <small class="text-muted">总存储大小</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center bg-info bg-opacity-10 border-info">
                            <div class="card-body">
                                <i class="fas fa-clock fa-2x text-info mb-2"></i>
                                <h4 class="text-info">${getLatestBackupTime(backupData.backups)}</h4>
                                <small class="text-muted">最新备份</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                ${backupData.backups.map((backup, index) => `
                    <div class="backup-item animate-slide-up" style="animation-delay: ${index * 0.1}s;">
                        <div class="row align-items-center">
                            <div class="col-md-7">
                                <h6 class="mb-1 fw-bold">
                                    <i class="fas fa-archive text-primary me-2"></i>
                                    ${backup.name}
                                </h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <small class="text-muted">
                                            <i class="fas fa-calendar me-1"></i>
                                            创建时间: ${backup.timestamp !== 'unknown' ? formatTimestamp(backup.timestamp) : '未知'}
                                        </small>
                                    </div>
                                    <div class="col-md-6">
                                        <small class="text-muted">
                                            <i class="fas fa-weight-hanging me-1"></i>
                                            大小: ${formatFileSize(backup.size || 0)}
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 text-center">
                                <div class="fw-bold text-primary">${backup.files ? backup.files.length : 0}</div>
                                <small class="text-muted">文件数量</small>
                            </div>
                            <div class="col-md-3 text-end">
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-info btn-sm" onclick="viewBackupDetails('${backup.name}')" data-tooltip="查看备份详情">
                                        <i class="fas fa-info-circle"></i>
                                    </button>
                                    <button class="btn btn-outline-success btn-sm" onclick="downloadBackup('${backup.name}')" data-tooltip="下载备份文件">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm" onclick="deleteBackup('${backup.name}')" data-tooltip="删除备份文件">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        ${backup.files && backup.files.length > 0 ? `
                        <div class="mt-3 pt-3 border-top">
                            <small class="text-muted fw-semibold">
                                <i class="fas fa-folder me-1"></i>包含文件:
                            </small>
                            <div class="d-flex flex-wrap gap-1 mt-2">
                                ${backup.files.slice(0, 8).map(file => `
                                    <span class="badge bg-light text-dark border">
                                        <i class="fas fa-file me-1"></i>${file.name}
                                    </span>
                                `).join('')}
                                ${backup.files.length > 8 ? `
                                    <span class="badge bg-secondary">
                                        <i class="fas fa-ellipsis-h me-1"></i>+${backup.files.length - 8}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `).join('')}
            `;
            
            container.innerHTML = backupsHtml;
        }

        // 创建备份
        async function createBackup() {
            const includeUploads = confirm('💾 备份选项设置：\n\n✅ 确定 = 完整备份（包含上传文件，备份较大）\n❌ 取消 = 快速备份（仅备份数据库和配置）\n\n建议：首次备份选择完整备份');
            
            try {
                showLoading('正在创建系统备份...');
                
                const response = await fetch(`/api/admin/system/backup?include_uploads=${includeUploads}`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess(`✅ 备份创建成功！\n\n📁 备份名称: ${result.data.name}\n💾 文件大小: ${formatFileSize(result.data.size || 0)}`);
                    loadBackups(); // 刷新备份列表
                } else {
                    showError('❌ 创建备份失败：' + (result.message || '未知错误'));
                }
            } catch (error) {
                console.error('创建备份失败:', error);
                showError('网络错误：' + error.message);
            } finally {
                hideLoading();
            }
        }

        // 查看备份详情
        async function viewBackupDetails(backupName) {
            try {
                showLoading('正在加载备份详情...');
                
                const response = await fetch(`/api/admin/system/backup/${encodeURIComponent(backupName)}/details`);
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    
                    let detailsHtml = `
                        📁 备份名称: ${data.name}
                        📅 创建时间: ${data.timestamp ? formatTimestamp(data.timestamp) : '未知'}
                        💾 文件大小: ${formatFileSize(data.size || 0)}
                        📊 文件数量: ${data.files ? data.files.length : 0}
                    `;
                    
                    if (data.files && data.files.length > 0) {
                        detailsHtml += '\n\n📋 包含文件:\n';
                        data.files.forEach(file => {
                            detailsHtml += `• ${file.name} (${formatFileSize(file.size || 0)})\n`;
                        });
                    }
                    
                    alert(detailsHtml);
                } else {
                    showError('获取备份详情失败');
                }
            } catch (error) {
                console.error('获取备份详情失败:', error);
                showError('网络错误：' + error.message);
            } finally {
                hideLoading();
            }
        }

        // 下载备份
        function downloadBackup(backupName) {
            if (confirm(`📥 确定要下载备份 "${backupName}" 吗？\n\n下载可能需要一些时间，请耐心等待。`)) {
                const downloadUrl = `/api/admin/system/backup/${encodeURIComponent(backupName)}/download`;
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = backupName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                showInfo('📥 备份下载已开始，请查看浏览器下载进度');
            }
        }

        // 删除备份
        async function deleteBackup(backupName) {
            if (!confirm(`🗑️ 确定要删除备份 "${backupName}" 吗？\n\n⚠️ 此操作不可撤销，删除后无法恢复！`)) {
                return;
            }
            
            try {
                showLoading('正在删除备份...');
                
                const response = await fetch(`/api/admin/system/backup/${encodeURIComponent(backupName)}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess(`✅ 备份 "${backupName}" 已成功删除`);
                    loadBackups(); // 刷新备份列表
                } else {
                    showError('❌ 删除备份失败：' + (result.message || '未知错误'));
                }
            } catch (error) {
                console.error('删除备份失败:', error);
                showError('网络错误：' + error.message);
            } finally {
                hideLoading();
            }
        }

        // 刷新所有数据
        async function refreshAllData() {
            try {
                showLoading('正在刷新所有系统数据...');
                
                await Promise.all([
                    loadSystemInfo(),
                    loadPerformanceMetrics(),
                    loadDatabaseStats()
                ]);
                
                showSuccess('🔄 系统数据已全部刷新！');
            } catch (error) {
                console.error('刷新数据失败:', error);
                showError('刷新数据失败，请检查网络连接');
            } finally {
                hideLoading();
            }
        }

        // 定期刷新指标
        async function refreshMetrics() {
            try {
                await loadPerformanceMetrics();
                console.log('📊 性能指标已自动刷新 -', new Date().toLocaleTimeString());
            } catch (error) {
                console.error('自动刷新失败:', error);
            }
        }

        // 辅助函数
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatTimestamp(timestamp) {
            if (!timestamp || timestamp === 'unknown') return '未知';
            
            // 如果是YYYYMMDD_HHMMSS格式
            if (timestamp.includes('_')) {
                const [datePart, timePart] = timestamp.split('_');
                const year = datePart.substring(0, 4);
                const month = datePart.substring(4, 6);
                const day = datePart.substring(6, 8);
                const hour = timePart.substring(0, 2);
                const minute = timePart.substring(2, 4);
                const second = timePart.substring(4, 6);
                
                return `${year}-${month}-${day} ${hour}:${minute}:${second}`;
            }
            
            // 尝试解析其他格式
            try {
                const date = new Date(timestamp);
                return date.toLocaleString('zh-CN');
            } catch (e) {
                return timestamp;
            }
        }

        function getLatestBackupTime(backups) {
            if (!backups || backups.length === 0) return '无';
            
            const latest = backups.reduce((latest, current) => {
                if (!latest.timestamp) return current;
                if (!current.timestamp) return latest;
                return current.timestamp > latest.timestamp ? current : latest;
            });
            
            if (latest.timestamp && latest.timestamp !== 'unknown') {
                const time = formatTimestamp(latest.timestamp);
                return time.includes(' ') ? time.split(' ')[0] : time;
            }
            
            return '未知';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ===== UI通知系统 =====
        function showLoading(text = '系统处理中...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showSuccess(message) {
            showNotification(message, 'success', 5000);
        }

        function showError(message) {
            showNotification(message, 'danger', 8000);
        }

        function showWarning(message) {
            showNotification(message, 'warning', 6000);
        }

        function showInfo(message) {
            showNotification(message, 'info', 4000);
        }

        function showNotification(message, type, duration) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed animate-slide-up`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 10000; min-width: 350px; max-width: 500px;';
            
            const icon = getNotificationIcon(type);
            alertDiv.innerHTML = `
                <div class="d-flex align-items-start">
                    <div class="me-2">${icon}</div>
                    <div class="flex-grow-1">${message.replace(/\n/g, '<br>')}</div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            document.body.appendChild(alertDiv);
            
            // 自动移除
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.classList.remove('show');
                    setTimeout(() => {
                        if (alertDiv.parentNode) {
                            alertDiv.parentNode.removeChild(alertDiv);
                        }
                    }, 300);
                }
            }, duration);
        }

        function getNotificationIcon(type) {
            const iconMap = {
                'success': '<i class="fas fa-check-circle fa-lg text-success"></i>',
                'danger': '<i class="fas fa-exclamation-triangle fa-lg text-danger"></i>',
                'warning': '<i class="fas fa-exclamation-circle fa-lg text-warning"></i>',
                'info': '<i class="fas fa-info-circle fa-lg text-info"></i>'
            };
            return iconMap[type] || '<i class="fas fa-bell fa-lg"></i>';
        }

        // ===== 键盘快捷键支持 =====
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + R: 刷新数据
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                refreshAllData();
            }
            
            // Ctrl/Cmd + B: 创建备份
            if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                e.preventDefault();
                createBackup();
            }
            
            // Ctrl/Cmd + L: 刷新日志
            if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                e.preventDefault();
                if (document.getElementById('logs-tab').classList.contains('active')) {
                    loadLogs();
                }
            }
            
            // ESC: 关闭加载遮罩
            if (e.key === 'Escape') {
                hideLoading();
            }
        });

        // ===== 页面可见性检测 =====
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                // 页面重新可见时刷新性能数据
                loadPerformanceMetrics();
            }
        });

        // ===== 页面卸载时清理定时器 =====
        window.addEventListener('beforeunload', function() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });

        // ===== 初始化完成提示 =====
        console.log('🖥️ AI姿势参考图库 - 系统监控中心已就绪');
        console.log('👤 当前用户:', 'marvinli001'); 
        console.log('🕒 初始化时间:', new Date().toLocaleString('zh-CN'));
        console.log('📊 功能模块: 性能监控、系统维护、配置管理、日志分析、备份恢复');
        console.log('⌨️  快捷键: Ctrl+R(刷新) | Ctrl+B(备份) | Ctrl+L(日志) | ESC(取消)');
        console.log('🎨 UI主题: 现代化渐变设计 | 实时图表 | 智能分析');
        console.log('⚡ 自动刷新: 每30秒更新性能指标');

        // ===== 性能监控 =====
        window.addEventListener('load', function() {
            const loadTime = performance.now();
            console.log(`⚡ 系统监控页面加载完成，耗时: ${Math.round(loadTime)}ms`);
            
            // 如果加载时间过长，显示提示
            if (loadTime > 3000) {
                setTimeout(() => {
                    showInfo('📊 系统监控页面加载完成！如果遇到性能问题，请尝试刷新页面。');
                }, 1000);
            }
        });

        // ===== 错误处理增强 =====
        window.addEventListener('error', function(e) {
            console.error('页面错误:', e.error);
            showError('❌ 页面发生错误，请刷新重试');
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('未处理的Promise错误:', e.reason);
            showError('❌ 网络请求失败，请检查连接后重试');
        });
    </script>
</body>
</html>