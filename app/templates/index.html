{% extends "base.html" %}

{% block title %}AI姿势参考图库 - 智能姿势搜索{% endblock %}

{% block content %}
<div class="hero-section">
    <div class="container py-5">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 fw-bold hero-title mb-4">
                    AI姿势参考图库
                </h1>
                <p class="lead hero-subtitle mb-4">
                    为插画师、摄影师、设计师量身打造的智能姿势参考库。
                    使用GPT-4o进行图像分析，支持自然语言搜索。
                </p>
                <div class="d-flex gap-3 mb-4">
                    <a href="/upload" class="btn btn-light btn-lg shadow">
                        <i class="fas fa-upload"></i> 上传图片
                    </a>
                    <a href="#search-section" class="btn btn-outline-light btn-lg">
                        <i class="fas fa-search"></i> 开始搜索
                    </a>
                </div>
                <div class="row text-center hero-stats">
                    <div class="col-4">
                        <div class="stat-item">
                            <h3 class="hero-stat-number" id="totalImages">-</h3>
                            <small class="hero-stat-label">张图片</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="stat-item">
                            <h3 class="hero-stat-number" id="totalTags">-</h3>
                            <small class="hero-stat-label">个标签</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="stat-item">
                            <h3 class="hero-stat-number" id="totalSearches">-</h3>
                            <small class="hero-stat-label">次搜索</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="feature-showcase">
                    <!-- 功能卡片1 - GPT-4o智能分析 -->
                    <div class="card shadow-lg border-0 feature-card">
                        <div class="card-body p-4">
                            <h5 class="feature-card-title">
                                <i class="fas fa-robot text-primary"></i> 
                                GPT-4o智能分析
                            </h5>
                            <p class="feature-card-text">
                                自动识别姿势、表情、场景、光线、角度等特征，
                                生成精准的标签和描述。
                            </p>
                        </div>
                    </div>
                    
                    <!-- 功能卡片2 - 自然语言搜索 -->
                    <div class="card shadow-lg border-0 mt-3 feature-card">
                        <div class="card-body p-4">
                            <h5 class="feature-card-title">
                                <i class="fas fa-comments text-success"></i> 
                                自然语言搜索
                            </h5>
                            <p class="feature-card-text">
                                支持"女性坐姿室内"、"男性站立户外"等
                                自然语言查询方式。
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 搜索区域 -->
<section id="search-section" class="py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <h2 class="text-center mb-4 section-title">智能姿势搜索</h2>
                
                <!-- 搜索框 -->
                <div class="search-container mb-4">
                    <div class="input-group input-group-lg">
                        <input type="text" class="form-control search-input" id="searchInput" 
                               placeholder="试试输入：女性坐姿、男性站立、思考表情...">
                        <button class="btn btn-primary search-btn" type="button" id="searchBtn">
                            <i class="fas fa-search"></i> 搜索
                        </button>
                    </div>
                    <div id="searchSuggestions" class="suggestions-dropdown"></div>
                </div>
                
                <!-- 热门搜索 -->
                <div class="popular-searches mb-4">
                    <h6 class="popular-title mb-3">热门搜索：</h6>
                    <div id="popularTags" class="d-flex flex-wrap gap-2">
                        <!-- 动态加载热门标签 -->
                    </div>
                </div>
                
                <!-- 高级搜索选项 -->
                <div class="advanced-search-toggle text-center">
                    <button class="btn btn-link advanced-toggle" type="button" data-bs-toggle="collapse" 
                            data-bs-target="#advancedSearch">
                        <i class="fas fa-cog"></i> 高级搜索选项
                    </button>
                </div>
                
                <div class="collapse" id="advancedSearch">
                    <div class="card mt-3 advanced-card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label filter-label">性别</label>
                                    <select class="form-select filter-select" id="genderFilter">
                                        <option value="">不限</option>
                                        <option value="女性">女性</option>
                                        <option value="男性">男性</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label filter-label">姿势类型</label>
                                    <select class="form-select filter-select" id="poseFilter">
                                        <option value="">不限</option>
                                        <option value="站姿">站姿</option>
                                        <option value="坐姿">坐姿</option>
                                        <option value="躺姿">躺姿</option>
                                        <option value="蹲姿">蹲姿</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label filter-label">场景</label>
                                    <select class="form-select filter-select" id="sceneFilter">
                                        <option value="">不限</option>
                                        <option value="室内">室内</option>
                                        <option value="户外">户外</option>
                                        <option value="办公室">办公室</option>
                                        <option value="家居">家居</option>
                                    </select>
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <button class="btn btn-primary advanced-apply" onclick="performAdvancedSearch()">
                                    <i class="fas fa-filter"></i> 应用筛选
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 搜索结果区域 -->
<section class="py-5" id="results-section" style="display: none;">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 id="resultsTitle" class="results-title">搜索结果</h3>
            <div class="view-controls">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary active" onclick="setViewMode('grid')">
                        <i class="fas fa-th"></i> 网格
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="setViewMode('list')">
                        <i class="fas fa-list"></i> 列表
                    </button>
                </div>
            </div>
        </div>
        
        <div id="searchResults" class="results-container">
            <!-- 搜索结果将在这里动态加载 -->
        </div>
        
        <!-- 加载更多 -->
        <div class="text-center mt-4" id="loadMoreSection" style="display: none;">
            <button class="btn btn-outline-primary" onclick="loadMoreResults()">
                <i class="fas fa-plus"></i> 加载更多
            </button>
        </div>
    </div>
</section>

<!-- 推荐图片区域 -->
<section class="py-5 bg-light" id="recommended-section">
    <div class="container">
        <h3 class="text-center mb-4 section-title">推荐图片</h3>
        <div id="recommendedImages" class="row">
            <!-- 推荐图片将在这里动态加载 -->
        </div>
    </div>
</section>
{% endblock %}

{% block styles %}
<style>
/* 修复首页文字颜色和对比度 */
.hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    min-height: 70vh;
    display: flex;
    align-items: center;
    position: relative;
}

/* 修改全局hero区域文字颜色规则，排除功能卡片 */
.hero-section > *:not(.feature-showcase),
.hero-section .hero-title,
.hero-section .hero-subtitle,
.hero-section .hero-stat-number,
.hero-section .hero-stat-label,
.hero-section .btn {
    color: white !important;
}

.hero-title, .hero-subtitle, .hero-stat-number, .hero-stat-label {
    color: white !important;
}

.hero-stats {
    margin-top: 2rem;
}

.hero-stat-number {
    color: white !important;
    font-weight: 700;
    font-size: 2rem;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

/* ===== 功能卡片区域样式修复 ===== */
.hero-section .feature-showcase {
    /* 重置继承的白色文字 */
    color: initial !important;
}

.hero-section .feature-showcase * {
    color: initial !important;
}

/* 功能卡片样式 - 更具体的选择器 */
.hero-section .feature-showcase .feature-card {
    background: white !important;
    color: #333 !important;
}

/* 功能卡片内容区域 */
.feature-showcase .feature-card .card-body {
    background: white !important;
    color: #333 !important;
}

/* 功能卡片标题样式 */
.feature-showcase .feature-card .feature-card-title {
    color: #333 !important;
    font-weight: 600 !important;
    font-size: 1.25rem !important;
    margin-bottom: 1rem !important;
}

/* 功能卡片描述文字 */
.feature-showcase .feature-card .feature-card-text {
    color: #555 !important;
    line-height: 1.6 !important;
    font-size: 0.95rem !important;
    margin-bottom: 0 !important;
}

/* 强制覆盖可能的继承样式 */
.hero-section .feature-showcase .card-title,
.hero-section .feature-showcase .card-text,
.hero-section .feature-showcase h5,
.hero-section .feature-showcase p {
    color: inherit !important;
}

/* 图标颜色保持 */
.feature-showcase .feature-card .text-primary {
    color: #0d6efd !important;
}

.feature-showcase .feature-card .text-success {
    color: #198754 !important;
}

.hero-section .feature-card .text-primary {
    color: #0d6efd !important;
}
.hero-section .feature-card .text-success {
    color: #198754 !important;
}

.hero-stat-label {
    color: rgba(255,255,255,0.9) !important;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

/* 按钮样式优化 */
.btn-light {
    background-color: white;
    border-color: white;
    color: #333 !important;
    font-weight: 600;
}

.btn-light:hover {
    background-color: rgba(255,255,255,0.9);
    color: #333 !important;
}

.btn-outline-light {
    border-color: white;
    color: white !important;
    font-weight: 600;
}

.btn-outline-light:hover {
    background-color: white;
    color: #333 !important;
}

/* 功能卡片容器 */
.feature-showcase .feature-card {
    background: white !important;
    border: none !important;
    transform: translateY(0);
    transition: transform 0.3s ease;
}

.feature-showcase .feature-card:hover {
    transform: translateY(-5px);
}

/* 功能卡片标题 - 强制深色 */
.feature-card-title {
    color: #333 !important;
    font-weight: 600 !important;
}

/* 功能卡片标题图标颜色 */
.feature-card-title .text-primary {
    color: #0d6efd !important;
}

.feature-card-title .text-success {
    color: #198754 !important;
}

.feature-card-text {
    color: #555 !important;
}

/* 确保卡片内所有元素都使用深色文字 */
.feature-card .card-body,
.feature-card .card-body * {
    color: #333 !important;
}

.feature-card .card-title {
    color: #333 !important;
}

.feature-card .card-text {
    color: #555 !important;
}

/* 搜索区域样式 */
.section-title {
    color: #333 !important;
    font-weight: 600;
    margin-bottom: 2rem;
}

.search-container {
    position: relative;
}

.search-input {
    border: 2px solid #e9ecef;
    font-size: 1rem;
    padding: 1rem;
    color: #333 !important;
}

.search-input:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13,110,253,0.25);
}

.search-input::placeholder {
    color: #6c757d !important;
}

.search-btn {
    padding: 1rem 2rem;
    font-weight: 600;
}

.suggestions-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #ddd;
    border-top: none;
    border-radius: 0 0 0.375rem 0.375rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    z-index: 1000;
    max-height: 200px;
    overflow-y: auto;
    display: none;
}

.suggestion-item {
    padding: 0.75rem 1rem;
    cursor: pointer;
    border-bottom: 1px solid #eee;
    color: #333 !important;
}

.suggestion-item:hover {
    background-color: #f8f9fa;
}

/* 热门搜索样式 */
.popular-title {
    color: #666 !important;
    font-weight: 600;
}

.popular-searches .badge {
    cursor: pointer;
    transition: transform 0.2s ease;
    background-color: #0d6efd !important;
    color: white !important;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
}

.popular-searches .badge:hover {
    transform: scale(1.05);
    background-color: #0b5ed7 !important;
}

/* 高级搜索样式 */
.advanced-toggle {
    color: #666 !important;
    text-decoration: none;
}

.advanced-toggle:hover {
    color: #0d6efd !important;
}

.advanced-card {
    border: 2px solid #e9ecef;
    background: white !important;
}

.filter-label {
    color: #333 !important;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.filter-select {
    border: 1px solid #ced4da;
    color: #333 !important;
    background: white !important;
}

.filter-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13,110,253,0.25);
}

.advanced-apply {
    padding: 0.75rem 2rem;
    font-weight: 600;
}

/* 搜索结果样式 */
.results-title {
    color: #333 !important;
    font-weight: 600;
}

.results-container.grid-view .image-card {
    margin-bottom: 2rem;
}

.results-container.list-view .image-card {
    margin-bottom: 1rem;
}

.image-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
    background: white !important;
}

.image-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.image-thumbnail {
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-radius: 0.375rem;
}

.confidence-badge {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    font-size: 0.75rem;
}

/* 文字颜色确保可读性 */
.card-text {
    color: #666 !important;
}

.card-title {
    color: #333 !important;
}

.text-muted {
    color: #6c757d !important;
}

.badge.bg-secondary {
    background-color: #6c757d !important;
    color: white !important;
}

.badge.bg-light {
    background-color: #f8f9fa !important;
    color: #333 !important;
}

/* 加载动画 */
.loading-skeleton {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

/* 响应式优化 */
@media (max-width: 768px) {
    .hero-section {
        min-height: 60vh;
        text-align: center;
    }
    
    .hero-title {
        font-size: 2.5rem;
    }
    
    .hero-subtitle {
        font-size: 1rem;
    }
    
    .feature-showcase {
        margin-top: 3rem;
    }
    
    .search-input {
        font-size: 0.9rem;
        padding: 0.8rem;
    }
    
    .search-btn {
        padding: 0.8rem 1.5rem;
    }
}

.hero-section .feature-card,
.hero-section .feature-card * {
    color: #333 !important;
}
.hero-section .feature-card .feature-card-title {
    color: #333 !important;
}
.hero-section .feature-card .feature-card-text {
    color: #555 !important;
}

/* 强制覆盖所有可能的Bootstrap样式冲突 */
.feature-card * {
    color: inherit !important;
}

.feature-card h5 {
    color: #333 !important;
}

.feature-card p {
    color: #555 !important;
}

/* 确保卡片内容区域是白色背景 */
.card-body {
    background-color: white !important;
}
</style>
{% endblock %}

{% block scripts %}
<script>
let currentSearchQuery = '';
let currentPage = 1;
let viewMode = 'grid';

document.addEventListener('DOMContentLoaded', function() {
    initializePage();
    setupSearchHandlers();
    loadRecommendedImages();
    loadPopularTags();
    loadStats();
});

async function initializePage() {
    // 初始化页面功能
    console.log('AI姿势参考图库初始化完成');
}

function setupSearchHandlers() {
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    
    // 搜索按钮点击
    searchBtn.addEventListener('click', performSearch);
    
    // 回车键搜索
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            performSearch();
        }
    });
    
    // 搜索建议
    let suggestionTimeout;
    searchInput.addEventListener('input', function() {
        clearTimeout(suggestionTimeout);
        suggestionTimeout = setTimeout(() => {
            showSearchSuggestions(this.value);
        }, 300);
    });
    
    // 点击其他地方隐藏建议
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.search-container')) {
            hideSearchSuggestions();
        }
    });
}

async function performSearch() {
    const query = document.getElementById('searchInput').value.trim();
    if (!query) {
        alert('请输入搜索关键词');
        return;
    }
    
    currentSearchQuery = query;
    currentPage = 1;
    
    showResultsSection();
    showSearchLoading();
    
    try {
        const response = await fetch(`/api/search?q=${encodeURIComponent(query)}&limit=20&use_ai=true`);
        const data = await response.json();
        
        if (data.success) {
            displaySearchResults(data.data);
        } else {
            showSearchError('搜索失败，请重试');
        }
    } catch (error) {
        showSearchError('网络错误：' + error.message);
    }
}

async function performAdvancedSearch() {
    const gender = document.getElementById('genderFilter').value;
    const pose = document.getElementById('poseFilter').value;
    const scene = document.getElementById('sceneFilter').value;
    
    let query = document.getElementById('searchInput').value.trim();
    
    // 构建高级搜索查询
    const filters = [gender, pose, scene].filter(f => f);
    if (filters.length > 0) {
        query = query ? `${query} ${filters.join(' ')}` : filters.join(' ');
    }
    
    if (!query) {
        alert('请输入搜索条件');
        return;
    }
    
    document.getElementById('searchInput').value = query;
    await performSearch();
}

function displaySearchResults(searchData) {
    const resultsContainer = document.getElementById('searchResults');
    const images = searchData.images || [];
    
    document.getElementById('resultsTitle').textContent = 
        `搜索"${currentSearchQuery}"的结果 (${images.length}张)`;
    
    if (images.length === 0) {
        resultsContainer.innerHTML = `
            <div class="text-center py-5">
                <i class="fas fa-search fa-3x text-muted mb-3"></i>
                <h5 style="color: #666;">没有找到相关图片</h5>
                <p style="color: #999;">尝试使用其他关键词或上传更多图片</p>
                <a href="/upload" class="btn btn-primary">
                    <i class="fas fa-upload"></i> 上传图片
                </a>
            </div>
        `;
        return;
    }
    
    resultsContainer.className = `results-container ${viewMode}-view`;
    
    let html = '';
    if (viewMode === 'grid') {
        html = '<div class="row">';
        images.forEach(image => {
            html += generateImageCard(image, 'col-lg-3 col-md-4 col-sm-6 mb-4');
        });
        html += '</div>';
    } else {
        images.forEach(image => {
            html += generateImageListItem(image);
        });
    }
    
    resultsContainer.innerHTML = html;
    
    // 显示加载更多按钮（如果有更多结果）
    const loadMoreSection = document.getElementById('loadMoreSection');
    if (images.length >= 20) {
        loadMoreSection.style.display = 'block';
    } else {
        loadMoreSection.style.display = 'none';
    }
}

function generateImageCard(image, colClass = '') {
    const confidence = (image.confidence * 100).toFixed(0);
    const tags = image.tags.slice(0, 3).map(tag => 
        `<span class="badge bg-secondary me-1">${tag.name}</span>`
    ).join('');
    
    return `
        <div class="${colClass}">
            <div class="card image-card border-0 shadow-sm" onclick="openImageDetail(${image.id})">
                <div class="position-relative">
                    <img src="${image.url}" class="image-thumbnail" alt="${image.description}">
                    <span class="badge bg-primary confidence-badge">${confidence}%</span>
                </div>
                <div class="card-body">
                    <p class="card-text small mb-2" style="color: #666;">${image.description || '暂无描述'}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="tags-container">
                            ${tags}
                        </div>
                        <small style="color: #999;">
                            <i class="fas fa-eye"></i> ${image.view_count}
                        </small>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function generateImageListItem(image) {
    const confidence = (image.confidence * 100).toFixed(0);
    const tags = image.tags.map(tag => 
        `<span class="badge bg-light me-1" style="color: #333;">${tag.name}</span>`
    ).join('');
    
    return `
        <div class="card image-card mb-3" onclick="openImageDetail(${image.id})">
            <div class="row g-0">
                <div class="col-md-3">
                    <img src="${image.url}" class="img-fluid rounded-start h-100" 
                         style="object-fit: cover;" alt="${image.description}">
                </div>
                <div class="col-md-9">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title" style="color: #333;">${image.filename}</h6>
                            <span class="badge bg-primary">${confidence}% 置信度</span>
                        </div>
                        <p class="card-text" style="color: #666;">${image.description || '暂无描述'}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="tags-container">
                                ${tags}
                            </div>
                            <div style="color: #999;">
                                <small>
                                    <i class="fas fa-eye"></i> ${image.view_count} | 
                                    <i class="fas fa-clock"></i> ${formatDate(image.upload_time)}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

async function showSearchSuggestions(query) {
    if (!query || query.length < 2) {
        hideSearchSuggestions();
        return;
    }
    
    try {
        const response = await fetch(`/api/search/suggestions?q=${encodeURIComponent(query)}`);
        const data = await response.json();
        
        if (data.success && data.data.suggestions.length > 0) {
            displaySuggestions(data.data.suggestions);
        } else {
            hideSearchSuggestions();
        }
    } catch (error) {
        console.error('获取搜索建议失败:', error);
        hideSearchSuggestions();
    }
}

function displaySuggestions(suggestions) {
    const dropdown = document.getElementById('searchSuggestions');
    
    let html = '';
    suggestions.forEach(suggestion => {
        html += `
            <div class="suggestion-item" onclick="selectSuggestion('${suggestion}')">
                <i class="fas fa-search text-muted me-2"></i>${suggestion}
            </div>
        `;
    });
    
    dropdown.innerHTML = html;
    dropdown.style.display = 'block';
}

function hideSearchSuggestions() {
    document.getElementById('searchSuggestions').style.display = 'none';
}

function selectSuggestion(suggestion) {
    document.getElementById('searchInput').value = suggestion;
    hideSearchSuggestions();
    performSearch();
}

async function loadPopularTags() {
    try {
        const response = await fetch('/api/search/popular');
        const data = await response.json();
        
        if (data.success) {
            const container = document.getElementById('popularTags');
            let html = '';
            
            data.data.popular_searches.forEach(tag => {
                html += `
                    <span class="badge bg-primary me-2 mb-2" onclick="searchTag('${tag}')">
                        ${tag}
                    </span>
                `;
            });
            
            container.innerHTML = html;
        }
    } catch (error) {
        console.error('加载热门标签失败:', error);
    }
}

async function loadRecommendedImages() {
    try {
        const response = await fetch('/api/images?per_page=8');
        const data = await response.json();
        
        if (data.success) {
            const container = document.getElementById('recommendedImages');
            let html = '';
            
            data.data.images.forEach(image => {
                html += generateImageCard(image, 'col-lg-3 col-md-4 col-sm-6 mb-4');
            });
            
            container.innerHTML = html;
        }
    } catch (error) {
        console.error('加载推荐图片失败:', error);
    }
}

async function loadStats() {
    try {
        const response = await fetch('/api/admin/stats');
        const data = await response.json();
        
        if (data.success) {
            const stats = data.data;
            document.getElementById('totalImages').textContent = stats.active_images || 0;
            document.getElementById('totalTags').textContent = stats.active_tags || 0;
            document.getElementById('totalSearches').textContent = stats.total_connections || 0;
        }
    } catch (error) {
        console.error('加载统计失败:', error);
    }
}

function searchTag(tag) {
    document.getElementById('searchInput').value = tag;
    performSearch();
}

function setViewMode(mode) {
    viewMode = mode;
    
    // 更新按钮状态
    document.querySelectorAll('.view-controls .btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // 重新显示结果
    if (document.getElementById('results-section').style.display !== 'none') {
        const resultsContainer = document.getElementById('searchResults');
        if (resultsContainer.innerHTML.trim()) {
            // 触发重新渲染
            performSearch();
        }
    }
}

function showResultsSection() {
    document.getElementById('results-section').style.display = 'block';
    document.getElementById('results-section').scrollIntoView({ 
        behavior: 'smooth', 
        block: 'start' 
    });
}

function showSearchLoading() {
    document.getElementById('searchResults').innerHTML = `
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">搜索中...</span>
            </div>
            <p class="mt-3" style="color: #666;">正在使用GPT-4o智能搜索...</p>
        </div>
    `;
}

function showSearchError(message) {
    document.getElementById('searchResults').innerHTML = `
        <div class="alert alert-danger text-center">
            <i class="fas fa-exclamation-triangle me-2"></i>${message}
        </div>
    `;
}

function openImageDetail(imageId) {
    window.open(`/image/${imageId}`, '_blank');
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('zh-CN');
}

async function loadMoreResults() {
    currentPage++;
    // 实现加载更多逻辑
    console.log('加载更多结果, 页码:', currentPage);
}
</script>
{% endblock %}